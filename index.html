<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>마음 도움기관 기억하기 (시작 전 공개)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 10px;
    background-color: #fafafa;
  }

  #info {
    margin: 15px auto;
    font-size: 18px;
  }

  .board {
    display: flex;
    flex-wrap: wrap;
    max-width: 1000px;
    width: 90%;
    margin: 20px auto;
    justify-content: center;
  }

  .card {
    width: 200px;
    height: 290px;
    margin: 10px;
    border: 2px solid #333;
    cursor: pointer;
    position: relative;
    box-sizing: border-box;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    user-select: none;
  }

  .card img {
    width: 100%;
    height: 100%;
    display: none;
  }

  .card.flipped img {
    display: block;
  }

  .card.back {
    background: url('back.png') no-repeat center/cover;
  }

  #message {
    font-size: 20px;
    margin-top: 10px;
    min-height: 1.5em;
  }

  /* 반응형 카드 크기 조절 */
  @media (max-width: 480px) {
    .card {
      width: 70px;
      height: 105px;
      margin: 6px;
    }
    #info {
      font-size: 16px;
    }
    #message {
      font-size: 18px;
    }
  }

  @media (min-width: 481px) and (max-width: 768px) {
    .card {
      width: 85px;
      height: 130px;
      margin: 8px;
    }
    #info {
      font-size: 17px;
    }
    #message {
      font-size: 19px;
    }
  }
</style>
</head>
<body>

<h1>마음 도움기관 기억하기</h1>

<div id="info">
  남은 시간: <span id="timer">60</span>초 |
  <button id="hintBtn">힌트 보기</button>
  힌트 남은 횟수: <span id="hintCount">2</span>
</div>

<div class="board" id="board"></div>

<p id="message">카드를 잠시 보여드립니다...</p>

<script>
const cardImages = [
  'img1.png', 'img2.png',
  'img3.png', 'img4.png'
];

const cards = cardImages.concat(cardImages);
cards.sort(() => Math.random() - 0.5);

const board = document.getElementById('board');
const message = document.getElementById('message');
const timerSpan = document.getElementById('timer');
const hintBtn = document.getElementById('hintBtn');
const hintCountSpan = document.getElementById('hintCount');

let firstCard = null;
let secondCard = null;
let lockBoard = true; // 시작 전 잠금
let matches = 0;

let timeLeft = 60; // 제한시간 60초
let timerInterval = null;

let hintCount = 2;

function createCard(src, index) {
  const card = document.createElement('div');
  card.classList.add('card');
  card.classList.add('flipped'); // 시작 시 모두 앞면 보여주기
  card.dataset.image = src;
  card.dataset.index = index;

  const img = document.createElement('img');
  img.src = src;
  card.appendChild(img);

  card.addEventListener('click', clickHandler);

  return card;
}

function clickHandler(e) {
  if(lockBoard) return;
  const card = e.currentTarget;
  if(card === firstCard) return;

  card.classList.remove('back');
  card.classList.add('flipped');

  if(!firstCard) {
    firstCard = card;
    return;
  }

  secondCard = card;
  lockBoard = true;

  if(firstCard.dataset.image === secondCard.dataset.image) {
    matches++;
    firstCard.classList.add('matched');
    secondCard.classList.add('matched');
    firstCard.removeEventListener('click', clickHandler);
    secondCard.removeEventListener('click', clickHandler);
    resetTurn();

    if(matches === cardImages.length) {
      clearInterval(timerInterval);
      message.textContent = '🎉 모든 카드를 맞췄습니다! 🎉';
      lockBoard = true;
    }
  } else {
    setTimeout(() => {
      firstCard.classList.add('back');
      firstCard.classList.remove('flipped');
      secondCard.classList.add('back');
      secondCard.classList.remove('flipped');
      resetTurn();
    }, 1000);
  }
}

function resetTurn() {
  firstCard = null;
  secondCard = null;
  lockBoard = false;
}

function startGame() {
  cards.forEach((src, i) => {
    board.appendChild(createCard(src, i));
  });

  setTimeout(() => {
    const allCards = document.querySelectorAll('.card');
    allCards.forEach(card => {
      card.classList.add('back');
      card.classList.remove('flipped');
    });
    lockBoard = false;
    message.textContent = '카드를 맞춰보세요!';

    timerInterval = setInterval(() => {
      timeLeft--;
      timerSpan.textContent = timeLeft;
      if(timeLeft <= 0) {
        clearInterval(timerInterval);
        message.textContent = '⏰ 시간이 종료되었습니다!';
        lockBoard = true;
        // 남은 카드 모두 앞면으로 뒤집기 및 클릭 막기
        const allCards = document.querySelectorAll('.card');
        allCards.forEach(card => {
          card.classList.remove('back');
          card.classList.add('flipped');
          card.removeEventListener('click', clickHandler);
        });
      }
    }, 1000);
  }, 3000);
}

// 힌트 버튼 기능
hintBtn.addEventListener('click', () => {
  if(lockBoard) return; // 힌트 중이거나 게임 잠금 상태면 무시
  if(hintCount <= 0) {
    alert('힌트 횟수를 모두 사용했습니다.');
    return;
  }

  hintCount--;
  hintCountSpan.textContent = hintCount;

  lockBoard = true; // 힌트 보여주는 동안 클릭 잠금

  const allCards = document.querySelectorAll('.card');
  // 모든 카드 앞면 보여주기
  allCards.forEach(card => {
    card.classList.remove('back');
    card.classList.add('flipped');
  });

  // 2초 후 다시 뒤집기 (맞춘 카드 제외)
  setTimeout(() => {
    allCards.forEach(card => {
      if(!card.classList.contains('matched')) {
        card.classList.add('back');
        card.classList.remove('flipped');
      }
    });
    lockBoard = false;
  }, 2000);
});

startGame();
</script>

</body>
</html>
